@using System.Globalization
@using BlazorBvgRevisionApp.MyComponents.Models
@using Domain.Enums

<MudGrid>
    <MudItem md="3" xs="6">
        <MudNumericField T="int" Label="VA Gültigkeitsjahrdatum" Min="2023" Step="1" @bind-Value="@Person.ValidityYearCertificate" Placeholder="Gültigkeitsjahr" />
    </MudItem>
    
    <MudItem md="3" xs="6">
        <MudTextField Required="true" RequiredError="" Label="Name" Variant="Variant.Text" @bind-Value="@Person.Name" />
    </MudItem>
    
    <MudItem md="3" xs="6">
        <MudDatePicker Label="Geburtsdatum" Editable="true" @bind-Date="@Person.DateOfBirth" DateFormat="yyyy-MM-dd" Required="true" RequiredError="" Placeholder="Geburtstag" Mask="@(new DateMask("0000-00-00"))"/>
    </MudItem>

    <MudItem md="3" xs="6">
        <GenderSelector Label="Geschlecht" SelectedGender="@gender" OnSelected="@(SetGender)" />
    </MudItem>

    <MudItem md="4">
        <MudNumericField Label="AHV-Jahreslohn" Format="n0" Min="0" Step="1000" @bind-Value="Person.ReportedSalary" Culture="CultureInfo.InvariantCulture"/>
    </MudItem>

    <MudItem md="4">
        <MudNumericField Label="BVG Alterguthaben Ende des Jahres" Format="n0" Min="0" Step="1000" @bind-Value="Person.BvgRetirementCapitalEndOfYear" Culture="CultureInfo.InvariantCulture"/>
    </MudItem>

    <MudItem md="4">
        <MudNumericField Label="Alterguthaben PK im Schlussalter" Format="n0" Min="0" Step="1000" @bind-Value="Person.FinalRetirementCapital" Culture="CultureInfo.InvariantCulture"/>
    </MudItem>

</MudGrid>

@code {
    private Gender? gender;

    [Parameter] public required BvgPersonViewModel Person { get; set; }

    protected override void OnParametersSet()
    {
        if (Person.Gender != Gender.Undefined)
        {
            gender = Person.Gender;
        }
    }

    private void SetGender(Gender? g)
    {
        gender = g;
        if (g.HasValue)
        {
            Person.Gender = g.Value;
        }
    }
}