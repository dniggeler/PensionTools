@using System.Globalization
@using BlazorBvgRevisionApp.MyComponents.Models
@using BlazorBvgRevisionApp.Pages.Converters

<MudGrid>
    <MudItem md="3" xs="12">
        <MudNumericField Label="Versicherter Lohn" Format="n0" Min="0" Step="1000" @bind-Value="PensionPlan.InsuredSalary"
                         HelperTextOnFocus="true"
                         HelperText="Lohn für die jährlichen Altersgutschriften"
                         Placeholder=""
                         Culture="CultureInfo.InvariantCulture" />
    </MudItem>

    <MudItem md="3" xs="12">
       <MudNumericField Label="Guthaben Ende Jahr" Format="n0" Min="0" Step="1000" @bind-Value="PensionPlan.RetirementCapitalEndOfYear"
                        HelperTextOnFocus="true"
                        HelperText="Gesamtes Altersguthaben gemäss BVG"
                        Culture="CultureInfo.InvariantCulture"/>
    </MudItem>

    <MudItem md="3" xs="12">
        <MudNumericField T="decimal" Label="Projektionszins" Converter="@PercentConverter.DecimalConverter"
                         Format="P2"
                         Min="0M" Max="0.05M" Step="0.005M" @bind-Value="PensionPlan.ProjectionInterestRate"
                         HelperTextOnFocus="true"
                         HelperText="Nicht garantierter (fiktiver) Zins auf dem Altersguthaben"
                         Culture="CultureInfo.InvariantCulture" />
    </MudItem>

    <MudItem md="3" xs="12">
        <MudNumericField T="decimal" Label="Umwandlungssatz" Converter="@PercentConverter.DecimalConverter" Format="P2" Min="0M" Step="0.001M" @bind-Value="PensionPlan.ConversionRate" Culture="CultureInfo.InvariantCulture" />
    </MudItem>
    
    <MudItem md="12">
        <MudDataGrid Items="@PensionPlan.RetirementCredits" HorizontalScrollbar="true" Bordered="true" Dense="true">
            <ToolBarContent>
                <MudText Typo="Typo.h6">Altersgutschriften</MudText>
            </ToolBarContent>
            <Columns>
                <PropertyColumn Property="x => x.FromAge" Title="Von" Sortable="false"/>
                <PropertyColumn Property="x => x.ToAge" Title="Bis" Sortable="false"/>
                <TemplateColumn Sortable="false" Title="Satz">
                    <CellTemplate>
                        <MudNumericField T="decimal" Converter="@PercentConverter.DecimalConverter" Format="P2" Min="0M" Step="0.01M" @bind-Value="context.Item.Rate"/>
                    </CellTemplate>
                </TemplateColumn>
            </Columns>
        </MudDataGrid>
    </MudItem>

</MudGrid>

@code {
    [Parameter] public required PensionPlanViewModel PensionPlan { get; set; }

    protected override void OnParametersSet()
    {
        if (PensionPlan is { BvgInsuredSalary: not null, InsuredSalary: null })
        {
            PensionPlan.InsuredSalary = PensionPlan.BvgInsuredSalary;
        }

        if (PensionPlan is { BvgRetirementCapitalEndOfYear: not null, RetirementCapitalEndOfYear: null })
        {
            PensionPlan.RetirementCapitalEndOfYear = PensionPlan.BvgRetirementCapitalEndOfYear;
        }
    }
}