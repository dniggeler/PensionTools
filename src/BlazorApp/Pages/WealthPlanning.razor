@page "/WealthPlanning"
@using PensionCoach.Tools.CommonTypes
@using Microsoft.Extensions.Logging

@inject ILogger<WealthPlanning> logger;

<RadzenContent Container="main">
    <ChildContent>
        <RadzenHeading Size="H1" Text="Finanzplanung">
        </RadzenHeading>
        <RadzenSteps NextText="Nächster" PreviousText="Vorheriger">
            <Steps>
                <RadzenStepsItem Text="Steuerperson" Selected="true">
                    <ChildContent>
                        <RadzenCard>
                            <ChildContent>
                                <div class="row">
                                    <div class="col-md-6">
                                        <h3>Name</h3>
                                        <RadzenTextBox Name="Name" @bind-Value="taxPerson.Name"></RadzenTextBox>
                                    </div>

                                    <div class="col-md-6">
                                        <h3>Zivilstand</h3>
                                        <RadzenRadioButtonList
                                            Name="CivilStatus"
                                            TValue="int"
                                            Value=@((int)taxPerson.CivilStatus)
                                            Change=@(args => { taxPerson.CivilStatus = (CivilStatus)args; })>
                                            <Items>
                                                <RadzenRadioButtonListItem Text="Ledig" Value="1" />
                                                <RadzenRadioButtonListItem Text="Verheiratet" Value="2" />
                                            </Items>
                                        </RadzenRadioButtonList>
                                    </div>

                                    <div class="col-md-12">
                                        <h3>Konfession</h3>
                                        <RadzenRadioButtonList
                                            Name="ReligousGroup"
                                            TValue="int"
                                            Value=@((int)taxPerson.ReligiousGroupType)
                                            Change=@(args => { taxPerson.ReligiousGroupType = (ReligiousGroupType)args; })>
                                            <Items>
                                                <RadzenRadioButtonListItem Text="andere" Value="0" />
                                                <RadzenRadioButtonListItem Text="evangelisch" Value="1" />
                                                <RadzenRadioButtonListItem Text="christ-katholisch" Value="2" />
                                                <RadzenRadioButtonListItem Text="römisch-katholisch" Value="3" />
                                            </Items>
                                        </RadzenRadioButtonList>
                                    </div>
                                    @if (taxPerson.CivilStatus == CivilStatus.Married)
                                    {
                                        <div class="col-md-12">
                                            <h3>Konfession Partner</h3>
                                            <RadzenRadioButtonList
                                                Name="ReligousGroupPartner"
                                                TValue="int"
                                                Change=@(args => { taxPerson.PartnerReligiousGroupType = (ReligiousGroupType)args; })
                                                Value=@((int)(taxPerson.PartnerReligiousGroupType ?? ReligiousGroupType.Other))>
                                                <Items>
                                                    <RadzenRadioButtonListItem Text="andere" Value="0" />
                                                    <RadzenRadioButtonListItem Text="evangelisch" Value="1" />
                                                    <RadzenRadioButtonListItem Text="christ-katholisch" Value="2" />
                                                    <RadzenRadioButtonListItem Text="römisch-katholisch" Value="3" />
                                                </Items>
                                            </RadzenRadioButtonList>
                                        </div>
                                    }
                                </div>
                            </ChildContent>
                        </RadzenCard>
                    </ChildContent>
                </RadzenStepsItem>
                <RadzenStepsItem Text="Steuerdaten">
                    <ChildContent>
                        <RadzenCard>
                            <ChildContent>
                                <div class="row">
                                    <div class="col-md-6">
                                        <h3>Steuerbarer Lohn</h3>
                                        <RadzenNumeric TValue="decimal" Format="n0" @bind-Value="taxPerson.TaxableIncome" />
                                    </div>
                                    <div class="col-md-6">
                                        <h3>Steuerbares Vermögen</h3>
                                        <RadzenNumeric TValue="decimal" Format="n0" @bind-Value="taxPerson.TaxableWealth"/>
                                    </div>
                                    <div class="col-md-6">
                                        <h3>Steuergemeinde</h3>
                                        <RadzenDropDown AllowClear="true" TValue="int" @bind-Value="@selectedMunicipality" Data="municipalities.Select(item => item.Name)"/>
                                    </div>
                                </div>
                            </ChildContent>
                        </RadzenCard>
                    </ChildContent>
                </RadzenStepsItem>
                <RadzenStepsItem Text="Simulation">
                    <ChildContent>
                        <RadzenCard>
                            <ChildContent>
                                <div class="row">
                                    <div class="col-md-6">
                                        <h3>Berechnungsjahr</h3>
                                        <RadzenNumeric TValue="int" @bind-Value="@calculationYear" />
                                    </div>
                                    <div class="col-md-6">
                                        <h3>Anzahl Perioden</h3>
                                        <RadzenNumeric TValue="int" @bind-Value="@numberOfPeriods"/>
                                    </div>
                                </div>
                            </ChildContent>
                        </RadzenCard>
                    </ChildContent>
                </RadzenStepsItem>
            </Steps>
        </RadzenSteps>
    </ChildContent>
</RadzenContent>

@code {
    private readonly TaxPerson taxPerson = DefaultTaxPerson.GetDefaultValues();
    private int calculationYear = 2021;
    private int numberOfPeriods = 10;
    private IReadOnlyCollection<MunicipalityModel> municipalities = new List<MunicipalityModel>();
    private int selectedMunicipality;

    protected override Task OnInitializedAsync()
    {
        municipalities = new List<MunicipalityModel>()
        {
            new()
            {
                BfsNumber = 261,
                Canton = Canton.ZH,
                Name = "Zürich",
            },
            new()
            {
                BfsNumber = 136,
                Canton = Canton.ZH,
                Name = "Langnau a.A.",
            },
            new()
            {
                BfsNumber = 139,
                Canton = Canton.ZH,
                Name = "Rüschlikon",
            },
            new()
            {
                BfsNumber = 3426,
                Canton = Canton.SG,
                Name = "Zuzwil",
            }
        };

        return base.OnInitializedAsync();
    }
}